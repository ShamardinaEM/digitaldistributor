# Digital Distributor

Платформа для продажи цифровых приложений с системой управления заказами, отзывами, модерацией и аналитикой.

## Описание проекта

Digital Distributor — это веб-приложение для цифрового дистрибьютора приложений, позволяющее:

- **Пользователям:**
  - Просматривать каталог приложений с поиском и фильтрацией по категориям
  - Покупать приложения и отслеживать свои заказы
  - Оставлять отзывы на купленные приложения
  - Обращаться в техническую поддержку и вести переписку
  - Просматривать профиль и купленные приложения

- **Модераторам:**
  - Просматривать отзывы, ожидающие модерации
  - Одобрять или отклонять отзывы пользователей

- **Службе поддержки:**
  - Просматривать все обращения пользователей
  - Брать заявки в работу и отвечать пользователям
  - Вести переписку по обращениям

- **Аналитикам:**
  - Просматривать метрики продаж (количество заказов, выручка, новые пользователи)
  - Анализировать топ продаваемых приложений
  - Изучать динамику продаж по дням и категориям
  - Отслеживать рост пользовательской базы

- **Администраторам:**
  - Полный доступ ко всем функциям системы
  - Управление сотрудниками
  - Закрытие обращений в поддержку

Приложение написано на TypeScript, использует:

- **Express.js** — для построения REST API
- **PostgreSQL** — в качестве основной базы данных с Row Level Security (RLS)
- **React** — для построения пользовательского интерфейса
- **React Query** — для управления состоянием сервера
- **Zustand** — для управления клиентским состоянием
- **JWT** — для аутентификации пользователей
- **Bcrypt** — для хеширования паролей
- **Zod** — для валидации данных

## Структура проекта

```
digital-distributor/
├── server/                 # Серверная часть
│   ├── db/                # Работа с базой данных
│   │   └── pool.ts        # Пул соединений и RLS контекст
│   ├── middleware/        # Middleware
│   │   └── auth.ts        # Аутентификация и авторизация
│   ├── routes/            # API маршруты
│   │   ├── auth.ts        # Аутентификация и регистрация
│   │   ├── apps.ts        # Каталог приложений и отзывы
│   │   ├── orders.ts      # Заказы и покупки
│   │   ├── support.ts     # Обращения пользователей
│   │   ├── moderation.ts  # Модерация отзывов
│   │   ├── employee-support.ts  # Обработка обращений
│   │   ├── analytics.ts   # Аналитические отчеты
│   │   ├── profile.ts     # Управление профилем
│   │   ├── providers.ts   # Информация о провайдерах
│   │   └── admin.ts       # Административные функции
│   └── index.ts           # Точка входа сервера
├── src/                   # Клиентская часть
│   ├── api/               # API клиенты
│   ├── components/        # React компоненты
│   │   ├── auth/          # Компоненты аутентификации
│   │   └── layout/        # Компоненты макета
│   ├── pages/             # Страницы приложения
│   ├── store/             # Zustand хранилища
│   └── types/             # TypeScript типы
└── package.json
```

## Модели данных

Основные таблицы базы данных:

- **users** — пользователи платформы
- **employees** — сотрудники (модераторы, поддержка, аналитики, администраторы)
- **positions** — должности сотрудников
- **providers** — провайдеры приложений
- **categories** — категории приложений
- **apps** — приложения в каталоге
- **sales** — продажи/заказы
- **reviews** — отзывы пользователей на приложения
- **support_requests** — обращения в техническую поддержку
- **support_messages** — сообщения в обращениях поддержки
- **purchases** — история покупок (связующая таблица)

## Установка и запуск

### Требования

- Node.js (версия 18 или выше)
- PostgreSQL (версия 12 или выше)
- npm или yarn

### Локальная установка

1. Клонируйте репозиторий и установите зависимости:

```bash
git clone <repository-url>
cd digital-distributor
npm install
```

2. Настройте базу данных PostgreSQL:

   - Создайте базу данных `digital_distributor`
   - Выполните SQL скрипты для создания схемы, таблиц, ролей и RLS политик
   - Наполните базу тестовыми данными (providers, categories, apps)

3. Создайте файл `.env` в корне проекта:

```env
# База данных
DATABASE_URL=postgresql://admin_user:secure_pass@localhost:5432/digital_distributor
DATABASE_SSL=false
DB_PASSWORD=secure_pass

# JWT
JWT_SECRET=your-secret-key-here

# Сервер
PORT=4000
CLIENT_URL=http://localhost:5173

# Клиент (опционально)
VITE_API_BASE_URL=http://localhost:4000/api
```

4. Запустите приложение:

```bash
# Запуск фронтенда и бэкенда одновременно
npm run dev:full

# Или по отдельности:
npm run dev          # Фронтенд (Vite)
npm run dev:server    # Бэкенд (Express)
```

Фронтенд будет доступен на `http://localhost:5173`, бэкенд API на `http://localhost:4000`.

### Сборка для продакшена

```bash
# Сборка фронтенда
npm run build

# Предпросмотр собранного фронтенда
npm run preview
```

## Безопасность

Приложение использует:

- **Row Level Security (RLS)** — политики безопасности на уровне строк в PostgreSQL для изоляции данных пользователей
- **JWT токены** — для аутентификации и авторизации
- **Bcrypt** — для безопасного хранения паролей
- **Zod** — для валидации входящих данных
- **Helmet** — для защиты HTTP заголовков
- **CORS** — для контроля доступа к API

## Технологический стек

### Backend
- **TypeScript** — типизированный JavaScript
- **Express.js** — веб-фреймворк для Node.js
- **PostgreSQL** — реляционная база данных
- **pg** — драйвер PostgreSQL для Node.js
- **JWT** — JSON Web Tokens для аутентификации
- **Bcrypt** — хеширование паролей
- **Zod** — валидация схем данных
- **Morgan** — HTTP logger middleware
- **CORS** — middleware для обработки CORS запросов
- **Helmet** — защита HTTP заголовков
- **Cookie Parser** — парсинг cookies

### Frontend
- **React** — библиотека для построения UI
- **TypeScript** — типизированный JavaScript
- **React Router** — маршрутизация
- **React Query** — управление серверным состоянием
- **Zustand** — управление клиентским состоянием
- **Axios** — HTTP клиент
- **Vite** — сборщик и dev-сервер

## Разработка

### Структура базы данных

База данных использует систему ролей PostgreSQL с Row Level Security:

- `db_admin` — администратор БД (полные права)
- `normal_user` — обычный пользователь
- `moderator_user` — модератор
- `support_user` — служба поддержки
- `analyst_user` — аналитик

Каждая роль имеет соответствующие RLS политики для доступа к данным.

## Лицензия

Проект создан в учебных целях.
